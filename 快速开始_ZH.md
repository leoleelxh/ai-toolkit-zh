# AI Toolkit å¿«é€Ÿå¼€å§‹æŒ‡å— ðŸš€

æ¬¢è¿Žä½¿ç”¨ AI Toolkit ä¸­æ–‡ç‰ˆï¼è¿™ä¸ªæŒ‡å—å°†å¸®åŠ©æ‚¨å¿«é€Ÿä¸Šæ‰‹ï¼Œå¼€å§‹æ‚¨çš„ç¬¬ä¸€ä¸ª AI æ¨¡åž‹è®­ç»ƒã€‚

## ðŸ“‹ å‡†å¤‡å·¥ä½œ

### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Linux (æŽ¨è) æˆ– Windows 10/11
- **Python**: 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬
- **GPU**: NVIDIA GPUï¼Œè‡³å°‘ 24GB æ˜¾å­˜ (ç”¨äºŽ FLUX.1 è®­ç»ƒ)
- **å†…å­˜**: 32GB ç³»ç»Ÿå†…å­˜ (æŽ¨è)
- **å­˜å‚¨**: è‡³å°‘ 100GB å¯ç”¨ç©ºé—´

### ç¡¬ä»¶æŽ¨è
| GPU åž‹å· | æ˜¾å­˜ | é€‚ç”¨åœºæ™¯ |
|---------|------|----------|
| RTX 3090 | 24GB | FLUX.1 LoRA è®­ç»ƒ âœ… |
| RTX 4090 | 24GB | FLUX.1 LoRA è®­ç»ƒ âœ… |
| RTX A5000 | 24GB | FLUX.1 LoRA è®­ç»ƒ âœ… |
| RTX 3080 | 10GB | SD 1.5/XL è®­ç»ƒ âš ï¸ |

## ðŸ› ï¸ å®‰è£…æ­¥éª¤

### 1. ä¸‹è½½ä»£ç 
```bash
# å…‹éš†ä»“åº“
git clone https://github.com/ostris/ai-toolkit.git
cd ai-toolkit

# æˆ–è€…å¦‚æžœæ‚¨ä½¿ç”¨çš„æ˜¯ä¸­æ–‡ç‰ˆ
git clone https://github.com/your-repo/ai-toolkit-zh.git
cd ai-toolkit-zh
```

### 2. åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒ
```bash
# Linux/Mac
python3 -m venv venv
source venv/bin/activate

# Windows
python -m venv venv
venv\Scripts\activate
```

### 3. å®‰è£…ä¾èµ–
```bash
# å®‰è£… PyTorch (CUDA 12.6 ç‰ˆæœ¬)
pip3 install torch==2.7.0 torchvision==0.22.0 torchaudio==2.7.0 --index-url https://download.pytorch.org/whl/cu126

# å®‰è£…å…¶ä»–ä¾èµ–
pip3 install -r requirements.txt
```

### 4. é…ç½® HuggingFace (ç”¨äºŽ FLUX.1)
```bash
# åˆ›å»ºçŽ¯å¢ƒå˜é‡æ–‡ä»¶
echo "HF_TOKEN=æ‚¨çš„HFä»¤ç‰Œ" > .env

# æˆ–è€…ç›´æŽ¥ç™»å½•
huggingface-cli login
```

> ðŸ’¡ **èŽ·å– HF ä»¤ç‰Œ**: è®¿é—® [HuggingFace è®¾ç½®](https://huggingface.co/settings/tokens) åˆ›å»ºè®¿é—®ä»¤ç‰Œ

## ðŸŽ¨ ç¬¬ä¸€æ¬¡è®­ç»ƒï¼šFLUX.1 LoRA

### å‡†å¤‡æ•°æ®é›†

1. **åˆ›å»ºæ•°æ®é›†æ–‡ä»¶å¤¹**
   ```bash
   mkdir -p datasets/my_character
   ```

2. **å‡†å¤‡å›¾åƒå’Œæ ‡é¢˜**
   ```
   datasets/my_character/
   â”œâ”€â”€ image1.jpg
   â”œâ”€â”€ image1.txt
   â”œâ”€â”€ image2.jpg
   â”œâ”€â”€ image2.txt
   â””â”€â”€ ...
   ```

3. **æ ‡é¢˜æ–‡ä»¶ç¤ºä¾‹** (`image1.txt`)
   ```
   ä¸€ä¸ªç©¿ç€è“è‰²è¡¬è¡«çš„å¹´è½»å¥³æ€§ï¼Œæ£•è‰²é•¿å‘ï¼Œåœ¨å’–å•¡åŽ…é‡Œå¾®ç¬‘
   ```

### é…ç½®è®­ç»ƒå‚æ•°

1. **å¤åˆ¶é…ç½®æ¨¡æ¿**
   ```bash
   cp config/examples/train_lora_flux_24gb_zh.yaml config/my_first_lora.yaml
   ```

2. **ç¼–è¾‘é…ç½®æ–‡ä»¶** (`config/my_first_lora.yaml`)
   ```yaml
   config:
     name: "my_character_lora_v1"  # æ‚¨çš„æ¨¡åž‹åç§°
     process:
       - type: 'sd_trainer'
         training_folder: "output"
         datasets:
           - folder_path: "datasets/my_character"  # æ‚¨çš„æ•°æ®é›†è·¯å¾„
             caption_ext: "txt"
             resolution: [512, 768, 1024]
         train:
           steps: 1500  # è®­ç»ƒæ­¥æ•°ï¼Œæ ¹æ®æ•°æ®é‡è°ƒæ•´
           batch_size: 1
           lr: 1e-4
         model:
           name_or_path: "black-forest-labs/FLUX.1-dev"
           quantize: true
   ```

### å¼€å§‹è®­ç»ƒ

```bash
# ä½¿ç”¨ä¸­æ–‡ç‰ˆè„šæœ¬
python run_zh.py config/my_first_lora.yaml

# æˆ–ä½¿ç”¨åŽŸç‰ˆè„šæœ¬
python run.py config/my_first_lora.yaml
```

## ðŸ“Š ç›‘æŽ§è®­ç»ƒè¿‡ç¨‹

### è®­ç»ƒè¾“å‡º
è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
æ­¥éª¤ 250/1500 | æŸå¤±: 0.145 | å­¦ä¹ çŽ‡: 1e-4 | æ˜¾å­˜: 18.2GB/24GB
ä¿å­˜æ£€æŸ¥ç‚¹: output/my_character_lora_v1/checkpoints/checkpoint-250.safetensors
ç”Ÿæˆæ ·æœ¬å›¾åƒ...
```

### æ–‡ä»¶ç»“æž„
```
output/my_character_lora_v1/
â”œâ”€â”€ checkpoints/          # æ£€æŸ¥ç‚¹æ–‡ä»¶
â”œâ”€â”€ samples/             # æ ·æœ¬å›¾åƒ
â”œâ”€â”€ logs/               # è®­ç»ƒæ—¥å¿—
â””â”€â”€ my_character_lora_v1.safetensors  # æœ€ç»ˆæ¨¡åž‹
```

## ðŸŽ­ ä½¿ç”¨ç®€æ˜“ç•Œé¢

å¦‚æžœæ‚¨æ›´å–œæ¬¢å›¾å½¢ç•Œé¢ï¼š

```bash
# å¯åŠ¨ä¸­æ–‡ç‰ˆ Gradio ç•Œé¢
python flux_train_ui_zh.py

# è®¿é—® http://localhost:7860
```

ç•Œé¢åŠŸèƒ½ï¼š
- âœ… æ‹–æ‹½ä¸Šä¼ å›¾åƒ
- âœ… è‡ªåŠ¨æ ‡é¢˜ç”Ÿæˆ
- âœ… å¯è§†åŒ–ç¼–è¾‘æ ‡é¢˜
- âœ… ä¸€é”®å¼€å§‹è®­ç»ƒ

## ðŸŒ Web ç®¡ç†ç•Œé¢

å¯åŠ¨å®Œæ•´çš„ Web ç®¡ç†ç•Œé¢ï¼š

```bash
cd ui
npm run build_and_start

# è®¿é—® http://localhost:8675
```

åŠŸèƒ½ç‰¹ç‚¹ï¼š
- ðŸ“Š è®­ç»ƒè¿›åº¦ç›‘æŽ§
- ðŸ“ æ•°æ®é›†ç®¡ç†
- ðŸ–¼ï¸ æ ·æœ¬å›¾åƒæŸ¥çœ‹
- âš™ï¸ é«˜çº§é…ç½®é€‰é¡¹

## ðŸŽ¯ è®­ç»ƒæŠ€å·§å’Œå»ºè®®

### æ•°æ®é›†è´¨é‡
âœ… **å¥½çš„æ•°æ®é›†**
- 15-30å¼ é«˜è´¨é‡å›¾åƒ
- ä¸»ä½“ä¸€è‡´ï¼Œå§¿åŠ¿å¤šæ ·
- æ ‡é¢˜è¯¦ç»†å‡†ç¡®
- åˆ†è¾¨çŽ‡ç»Ÿä¸€ (æŽ¨è 1024x1024)

âŒ **é¿å…çš„é—®é¢˜**
- å›¾åƒè´¨é‡å·®æˆ–æ¨¡ç³Š
- ä¸»ä½“ä¸ä¸€è‡´
- æ ‡é¢˜è¿‡äºŽç®€å•
- æ•°é‡è¿‡å¤š (>100å¼ ) æˆ–è¿‡å°‘ (<4å¼ )

### å‚æ•°è°ƒä¼˜
| å‚æ•° | æŽ¨èå€¼ | è¯´æ˜Ž |
|-----|--------|------|
| `steps` | 1000-3000 | å›¾åƒå°‘ç”¨å°‘æ­¥æ•°ï¼Œå›¾åƒå¤šç”¨å¤šæ­¥æ•° |
| `lr` | 1e-4 | å­¦ä¹ çŽ‡ï¼Œå¯å°è¯• 5e-5 åˆ° 2e-4 |
| `batch_size` | 1 | 24GBæ˜¾å­˜é™åˆ¶ |
| `linear` | 16-64 | LoRAç»´åº¦ï¼Œå½±å“æ¨¡åž‹å®¹é‡ |

### åœæ­¢æ¡ä»¶
è§‚å¯Ÿåˆ°ä»¥ä¸‹æƒ…å†µæ—¶åº”åœæ­¢è®­ç»ƒï¼š
- æ ·æœ¬å›¾åƒè´¨é‡ä¸å†æ”¹å–„
- è¿‡æ‹Ÿåˆè¿¹è±¡ (å›¾åƒè¿‡äºŽç›¸ä¼¼è®­ç»ƒæ•°æ®)
- æŸå¤±å€¼ä¸å†ä¸‹é™

## ðŸ”§ å¸¸è§é—®é¢˜è§£å†³

### æ˜¾å­˜ä¸è¶³
```yaml
model:
  quantize: true      # å¯ç”¨é‡åŒ–
  low_vram: true     # ä½Žæ˜¾å­˜æ¨¡å¼
train:
  gradient_checkpointing: true  # æ¢¯åº¦æ£€æŸ¥ç‚¹
```

### è®­ç»ƒé€Ÿåº¦æ…¢
- ä½¿ç”¨ `bf16` æ•°æ®ç±»åž‹
- å¯ç”¨ `cache_latents_to_disk: true`
- æ£€æŸ¥ç¡¬ç›˜è¯»å†™é€Ÿåº¦

### ç”Ÿæˆæ•ˆæžœä¸ä½³
- æ£€æŸ¥æ ‡é¢˜è´¨é‡
- è°ƒæ•´å­¦ä¹ çŽ‡
- å¢žåŠ è®­ç»ƒæ­¥æ•°
- æ£€æŸ¥è§¦å‘è¯ä½¿ç”¨

## ðŸ“š è¿›é˜¶ä¸»é¢˜

### å¤šæ¨¡åž‹è®­ç»ƒ
```bash
# åŒæ—¶è®­ç»ƒå¤šä¸ªé…ç½®
python run_zh.py config/model1.yaml config/model2.yaml -r
```

### å±‚çº§é€‰æ‹©è®­ç»ƒ
```yaml
network:
  network_kwargs:
    only_if_contains:
      - "transformer.single_transformer_blocks.7"
      - "transformer.single_transformer_blocks.20"
```

### è‡ªå®šä¹‰é‡‡æ ·æç¤º
```yaml
sample:
  prompts:
    - "æ‚¨çš„è‡ªå®šä¹‰æç¤ºè¯1"
    - "æ‚¨çš„è‡ªå®šä¹‰æç¤ºè¯2"
```

## ðŸ†˜ èŽ·å–å¸®åŠ©

- ðŸ“– **æ–‡æ¡£**: æŸ¥çœ‹ `docs/concepts_zh.md` äº†è§£è¯¦ç»†æ¦‚å¿µ
- â“ **FAQ**: æŸ¥çœ‹ `FAQ_ZH.md` èŽ·å–å¸¸è§é—®é¢˜è§£ç­”
- ðŸ’¬ **ç¤¾åŒº**: åŠ å…¥ [Discord æœåŠ¡å™¨](https://discord.gg/VXmU2f5WEU)
- ðŸ› **æŠ¥å‘Šé—®é¢˜**: åœ¨ GitHub ä¸Šæäº¤ Issue

## ðŸŽ‰ æˆåŠŸï¼

æ­å–œæ‚¨å®Œæˆç¬¬ä¸€æ¬¡è®­ç»ƒï¼çŽ°åœ¨æ‚¨å¯ä»¥ï¼š

1. **æµ‹è¯•æ¨¡åž‹**: åœ¨æ”¯æŒ FLUX.1 çš„ç”Ÿæˆç•Œé¢ä¸­åŠ è½½æ‚¨çš„ LoRA
2. **è°ƒä¼˜å‚æ•°**: å°è¯•ä¸åŒçš„é…ç½®ä»¥èŽ·å¾—æ›´å¥½æ•ˆæžœ
3. **åˆ†äº«ä½œå“**: ä¸Žç¤¾åŒºåˆ†äº«æ‚¨çš„è®­ç»ƒæˆæžœ
4. **æŽ¢ç´¢æ›´å¤š**: å°è¯•å…¶ä»–æ¨¡åž‹å’Œè®­ç»ƒç±»åž‹

è®­ç»ƒæ„‰å¿«ï¼ðŸš€âœ¨